import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-BmCqpbgl.js";const l={};function h(t,s){return n(),a("div",null,s[0]||(s[0]=[e(`<p>Linux 的 cgroup（控制组）特性是一种强大的工具，它允许你限制、记录和隔离进程组所使用的物理资源（包括 CPU、内存、磁盘 I/O 等）。如果你想限制一个进程或一组进程的最大内存使用量，你可以使用 cgroup 的内存限制功能。</p><p>以下是如何使用 cgroup 来限制最大内存使用的基本步骤：</p><ol><li><p><strong>创建 cgroup</strong>:<br> 使用 <code>cgcreate</code> 命令创建一个新的 cgroup。例如，创建一个名为 <code>mygroup</code> 的 cgroup，可以使用以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cgcreate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory:/mygroup</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>设置内存限制</strong>:<br> 使用 <code>cgset</code> 命令为 cgroup 设置内存限制。例如，将 <code>mygroup</code> 的内存限制设置为 200MB，可以使用以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cgset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory.limit_in_bytes=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">209715200</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mygroup</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>将进程添加到 cgroup</strong>:<br> 使用 <code>cgclassify</code> 命令将进程添加到 cgroup。例如，将进程 ID 为 1234 的进程添加到 <code>mygroup</code>，可以使用以下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cgclassify</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> memory:mygroup</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1234</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>这样，进程 ID 为 1234 的进程及其子进程将被限制在最多使用 200MB 的内存。</p><p>注意：这些命令可能需要 root 权限来执行。此外，确保你的系统安装了 cgroup 工具，这些工具可能在某些 Linux 发行版中不是默认安装的。</p><p>通过这些步骤，你可以有效地控制 Linux 系统上进程组的内存使用，有助于防止单个进程消耗过多的内存资源，从而影响系统的整体稳定性和性能。</p><p>要通过 Linux 的 cgroup 特性限制 Docker 所有容器的最大内存使用，你可以利用 Docker 自身的内存限制功能，这实际上是基于 cgroup 实现的。Docker 允许你在容器级别设置内存和 CPU 的限制。</p><p>以下是如何为 Docker 容器设置内存限制的基本步骤：</p><ol><li><p><strong>创建或更新 Docker 容器时设置内存限制</strong>：<br> 使用 <code>docker run</code> 命令创建容器时，可以使用 <code>--memory</code> 或 <code>-m</code> 选项来设置内存限制。例如，要创建一个内存限制为 500MB 的容器，可以运行：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 500m</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my_container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my_image</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果你想要更新一个已经存在的容器的内存限制，可以使用 <code>docker update</code> 命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --memory</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 500m</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --memory-swap</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> my_container</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里 <code>--memory-swap</code> 设置为 <code>-1</code> 表示不限制 swap 空间的使用，如果你想要限制 swap 空间，可以将其设置为一个具体的值，比如 <code>--memory-swap 1g</code>。</p></li><li><p><strong>为 Docker 守护进程设置默认内存限制</strong>：<br> 你也可以在 Docker 守护进程的配置文件 <code>/etc/docker/daemon.json</code> 中设置默认的内存和 swap 限制，这样所有新创建的容器都会继承这些限制，除非在创建时明确指定了其他值。例如：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;default-ulimits&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    &quot;nofile&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;name&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;nofile&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;hard&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;soft&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;default-memory-limit&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;500m&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;default-memory-swap&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;-1&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改配置文件后，需要重启 Docker 守护进程来使更改生效。</p></li><li><p><strong>验证内存限制</strong>：<br> 你可以使用 <code>docker stats</code> 命令来查看容器的内存使用情况，以验证内存限制是否生效。</p></li></ol><p>通过这些步骤，你可以有效地控制 Docker 容器在 Linux 系统上的内存使用，防止单个容器消耗过多的内存资源。</p>`,10)]))}const p=i(l,[["render",h]]),d=JSON.parse('{"path":"/%E7%BC%96%E7%A8%8B%E7%9B%B8%E5%85%B3/Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84cgroups%E7%9A%84%E4%BA%86%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8.html","title":"Linux系统中的cgroups的了解与应用","lang":"zh-CN","frontmatter":{"title":"Linux系统中的cgroups的了解与应用","icon":"pen-to-square","date":"2024-09-12T00:00:00.000Z","category":["Linux"],"tag":["Linux","docker","cgroups"]},"git":{"createdTime":1738742829000,"updatedTime":1738742829000,"contributors":[{"name":"SunshineAI","username":"SunshineAI","email":"2273766063@qq.com","commits":1,"url":"https://github.com/SunshineAI"}]},"readingTime":{"minutes":2.83,"words":849},"filePathRelative":"编程相关/Linux系统中的cgroups的了解与应用.md","excerpt":"<p>Linux 的 cgroup（控制组）特性是一种强大的工具，它允许你限制、记录和隔离进程组所使用的物理资源（包括 CPU、内存、磁盘 I/O 等）。如果你想限制一个进程或一组进程的最大内存使用量，你可以使用 cgroup 的内存限制功能。</p>\\n<p>以下是如何使用 cgroup 来限制最大内存使用的基本步骤：</p>\\n<ol>\\n<li>\\n<p><strong>创建 cgroup</strong>:<br>\\n使用 <code>cgcreate</code> 命令创建一个新的 cgroup。例如，创建一个名为 <code>mygroup</code> 的 cgroup，可以使用以下命令：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> cgcreate</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -g</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> memory:/mygroup</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div></li>\\n<li>\\n<p><strong>设置内存限制</strong>:<br>\\n使用 <code>cgset</code> 命令为 cgroup 设置内存限制。例如，将 <code>mygroup</code> 的内存限制设置为 200MB，可以使用以下命令：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> cgset</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -r</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> memory.limit_in_bytes=</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\">209715200</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> mygroup</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div></li>\\n<li>\\n<p><strong>将进程添加到 cgroup</strong>:<br>\\n使用 <code>cgclassify</code> 命令将进程添加到 cgroup。例如，将进程 ID 为 1234 的进程添加到 <code>mygroup</code>，可以使用以下命令：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> cgclassify</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -g</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> memory:mygroup</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 1234</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div></li>\\n</ol>"}');export{p as comp,d as data};
